<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="assets/styles/app.css">
</head>
<body>

<script src="bower_components/medium-editor/dist/js/medium-editor.js"></script>
<link rel="stylesheet" href="bower_components/medium-editor/dist/css/medium-editor.css">
<link rel="stylesheet" href="bower_components/medium-editor/dist/css/themes/default.css">

<script src="bower_components/jquery/dist/jquery.min.js"></script>
<script src="bower_components/jquery-ui/jquery-ui.min.js"></script>

<script src="libs/socket.io-1.4.3.js"></script>

<script>
  var socket = io.connect('http://localhost:8080/');
  var editors = [];

  socket.on('postits.upsert', function (postit) {
    console.log(postit);

    // Already displayed PostIt
    if ($('div.postit.id' + postit.id).length > 0) {
      $('div.postit.id' + postit.id).text(postit.text);
    } else {
        var element = $('<div data-position="' + postit.position + '" class="post-it-note ui-widget-content ui-draggable ui-draggable-handle" id="id' + postit.id + '">' + postit.text + '</div>').draggable({
            stop: function(event, ui) {
                console.log($('#id'+postit.id));
                var pos = $('#id'+postit.id).position();
                console.log(pos);
                socket.emit('postits.upsert', { id:$('#id' + postit.id), text: $('#id' + postit.id).text(), position: pos.left + ',' + pos.top});
            }
        });
        $('body').append(element);

        var editor = new MediumEditor('.id-' + postit.id);
        editor.subscribe('editableInput', function (event, editable) {
            socket.emit('postits.upsert', {
                id: event.target.id,
                text: event.target.textContent,
                position: [50, 300]
            });
        });
        editors.push(editor);
    }
  });

  socket.emit('postits.upsert', { text: 'data', position: [50, 300] });

</script>

</body>
</html>

